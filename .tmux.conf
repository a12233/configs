# Remap prefix from 'C-b' to 'C-a'
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Pane navigation (vim-style)
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# Vim-style pane resizing with Alt key
bind-key -n M-h resize-pane -L 5
bind-key -n M-j resize-pane -D 5
bind-key -n M-k resize-pane -U 5
bind-key -n M-l resize-pane -R 5

# Rotate panes clockwise with Alt+r and counter-clockwise with Alt+R
bind-key -n M-r rotate-window -D
bind-key -n M-R rotate-window -U

# Scroll through sessions with alt and 9/0
bind -n M-9 switch-client -p  # Alt+9 for previous
bind -n M-0 switch-client -n  # Alt+0 for next

# Split panes using | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Kill window and pane
bind-key & kill-window
bind-key x kill-pane

# Use mouse
set -g mouse on

# Enable vi mode for better keyboard navigation
set-window-option -g mode-keys vi

# Switch to active session when closing session
set-option -g detach-on-destroy off

# Copy mode bindings
# Enter copy mode with prefix + [
# Then use vi navigation keys (j, k, u, d, etc.) to scroll
# Exit with 'q'
bind-key -T copy-mode-vi 'C-d' send-keys -X page-down
bind-key -T copy-mode-vi 'C-u' send-keys -X page-up

# Faster scrolling with Alt+j/k (half page)
bind-key -T copy-mode-vi 'M-j' send-keys -X halfpage-down \; send-keys -X middle-line
bind-key -T copy-mode-vi 'M-k' send-keys -X halfpage-up \; send-keys -X middle-line

# After copying with mouse don't go to the end of the pane
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection

# Increase scrollback buffer size
set-option -g history-limit 10000

# Ensure RGB color support
set -sa terminal-overrides ',*:RGB'

# Explicitly set the hyperlink escape sequences
set -ga terminal-features ',*:hyperlinks'
set -as terminal-overrides ',*:Hls=\E]8;id=%p1%s;%p2%s\E\\:Hlr=\E]8;;\E\\'

# Pane highlighting - active/inactive visual distinction
# High contrast colors for better visibility
set -g pane-active-border-style 'fg=colour208,bold'  # Bright orange/yellow
set -g pane-border-style 'fg=colour237'              # Dark gray

# Dim inactive panes more aggressively (works better than borders)
set -g window-active-style 'fg=terminal,bg=terminal'
set -g window-style 'fg=colour244,bg=colour234'      # More dimming

# Fix for active pane detection with interactive applications (Warp terminal)
set -g focus-events on
set -g status-interval 1
set-hook -g pane-focus-in "refresh-client -S"
set-hook -g pane-focus-out "refresh-client -S"

# Additional Warp terminal compatibility
set -g allow-passthrough on

# Status bar - show battery, RAM, and time
set -g status-right "#(cd #{pane_current_path} && git branch --show-current 2>/dev/null | sed 's/^/ /') #{pane_current_path} | WiFi: #(iwgetid -r) | BAT: #(cat /sys/class/power_supply/BAT0/capacity)%#(cat /sys/class/power_supply/ADP1/online | grep -q 1 && echo '+' || echo '') | RAM: #(free -h | awk '/^Mem:/ {print $7}') | %H:%M"
set -g status-right-length 120

# Reload tmux config
bind-key r source-file ~/.tmux.conf \; display-message "~/.tmux.conf reloaded"

# Fuzzy find projects and create/attach to session
bind-key f display-popup -E "\
  cd ~/workplace && \
  selected=\$(find . -type d -maxdepth 1 -exec basename {} \\; | sort | fzf) && \
  if [[ -n \$selected ]]; then \
    tmux has-session -t=\$selected 2>/dev/null && \
    tmux switch-client -t \$selected || \
    tmux new-session -d -s \$selected -c ~/workplace/\$selected && \
    tmux switch-client -t \$selected; \
  fi \
"

